<UserControl
    x:Class="NarakaBladepoint.Controls.UpwardComboBox"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:NarakaBladepoint.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="30"
    d:DesignWidth="200"
    mc:Ignorable="d">
    <Grid>
        <Border
            x:Name="PART_DisplayBorder"
            Background="Transparent"
            BorderThickness="1"
            MouseLeftButtonDown="DisplayBorder_MouseLeftButtonDown">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="20" />
                </Grid.ColumnDefinitions>
                <ContentPresenter
                    Grid.Column="0"
                    VerticalAlignment="Center"
                    Content="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    ContentTemplate="{Binding ItemTemplate, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                <Path
                    x:Name="ArrowCollapsed"
                    Grid.Column="1"
                    Width="8"
                    Height="5"
                    Margin="0,0,4,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Data="M 0 0 L 8 0 L 4 5 Z"
                    Fill="White" />
                <Path
                    x:Name="ArrowExpanded"
                    Grid.Column="1"
                    Width="5"
                    Height="8"
                    Margin="0,0,4,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Data="M 0 0 L 5 4 L 0 8 Z"
                    Fill="White"
                    Visibility="Collapsed" />
            </Grid>
        </Border>
        <Popup
            x:Name="PART_Popup"
            Width="{Binding ActualWidth, ElementName=PART_DisplayBorder}"
            AllowsTransparency="True"
            Placement="Top"
            PlacementTarget="{Binding ElementName=PART_DisplayBorder}"
            PopupAnimation="Slide"
            StaysOpen="True">
            <Border
                Background="Transparent"
                BorderBrush="Gray"
                BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="20" />
                    </Grid.ColumnDefinitions>
                    <ItemsControl
                        x:Name="PART_ItemsControl"
                        ItemTemplate="{Binding ItemTemplate, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        ItemsSource="{Binding ItemsSource, RelativeSource={RelativeSource AncestorType=UserControl}}">
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Height" Value="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <EventSetter Event="MouseLeftButtonDown" Handler="Item_MouseLeftButtonDown" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                    </ItemsControl>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</UserControl>